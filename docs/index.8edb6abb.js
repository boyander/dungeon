function i(i,e,W,t){Object.defineProperty(i,e,{get:W,set:t,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},W={},t={},s=e.parcelRequire5350;null==s&&((s=function(i){if(i in W)return W[i].exports;if(i in t){var e=t[i];delete t[i];var s={id:i,exports:{}};return W[i]=s,e.call(s.exports,s,s.exports),s.exports}var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(i,e){t[i]=e},e.parcelRequire5350=s),s.register("bXuNP",(function(e,W){var t,s;i(e.exports,"register",(()=>t),(i=>t=i)),i(e.exports,"resolve",(()=>s),(i=>s=i));var n={};t=function(i){for(var e=Object.keys(i),W=0;W<e.length;W++)n[e[W]]=i[e[W]]},s=function(i){var e=n[i];if(null==e)throw new Error("Could not resolve bundle with id "+i);return e}})),s("bXuNP").register(JSON.parse('{"aYtYf":"index.8edb6abb.js","6DGUb":"dungeonStuffs4.858ecf4e.png","lBejV":"link.be376b96.png","7FNnd":"skeleton.4edd6763.png"}'));const n=["\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\nW............WW............W\nW.WWWW.iWWWi.WW.iWWWi.WWWW.W\nW.WWWW.WWWWW.WW.WWWWW.WWWW.W\nW.WWWW.WWWWW.ii.WWWWW.WWWW.W\nW..........................W\nW.WWWW.WW.WWWWWWWW.WW.WWWW.W\nW.WWWW.WW.WWWWWWWW.WW.WWWW.W\nW......WW....WW....WW......W\nW.iWWi.WWWWi.WW.iWWWW.iWWi.W\nW.WWWW.WWWWW.WW.WWWWW.WWWW.W\nW.WWWW.WW..........WW.WWWW.W\nW.WWWW.WW.iWWWWWWi.WW.WWWW.W\nW.iWWi.WW.WeeeeeeW.WW.iWWi.W\nW.........WeeSeeeW.........W\nW.WWWW.WW.WeeeeeeW.WW.WWWW.W\nW.WWWW.WW.WWieeiWW.WW.WWWW.W\nW.WWWW.WW..........WW.WWWW.W\nW.WWWW.WW.WWWWWWWW.WW.WWWW.W\nW.WWWW.WW.WWWWWWWW.WW.WWWW.W\nW............WW............W\nW.iWWi.WWWWW.WW.WWWWW.iWWi.W\nW.WWWW.WWWWW.WW.WWWWW.WWWW.W\nW...WW................WW...W\nWWW.WW.WW.iWWWWWWi.WW.WW.WWW\nWWW.WW.WW.WWWWWWWW.WW.WW.WWW\nW......WW....WW....WW......W\nW.iWWWWWWWWW.WW.WWWWWWWWWi.W\nW.WWWWWWWWWW.WW.WWWWWWWWWW.W\nW..........................W\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\n","\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\nW......WW....WW....WW......W\nW.iWWi.WW.Wi.WW.iW.WW.iWWi.W\nW.WWWW.WW.WW.WW.WW.WW.WWWW.W\nW.iWWi.WW.WW.ii.WW.WW.iWWi.W\nW......WW..........WW......W\nWWWWWW.WW.iWWWWWWi.WW.WWWWWW\nWWWWWW.WW.WWWWWWWW.WW.WWWWWW\nW......WW....WW....WW......W\nWWWWWi.WWWWi.WW.iWWWW.iWWWWW\nWWWWWi.WWWWW.WW.WWWWW.iWWWWW\nW......WW..........WW......W\nW.iWWi.WW.iWWeeWWi.WW.iWWi.W\nW.WWWW.WW.WeeeeeeW.WW.WWWW.W\nW.WWWW....eeeSeeee....WWWW.W\nW.WWWWWWi.WeeeeeeW.iWWWWWW.W\nW.iWWWWWW.WWieeiWW.WWWWWWi.W\nW......WW..........WW......W\nW.WWWW.WW.WWWWWWWW.WW.WWWWWW\nW.WWWW.WW.WWWWWWWW.WW.WWWWWW\nW............WW............W\nW.iWWi.WWWWW.WW.WWWWW.iWWi.W\nW.WWWW.WWWWW.WW.WWWWW.WWWW.W\nW...WW.......WW.......WW...W\nWWi.WWWWi.iWWWWWWi.iWWWW.iWW\nWWi.WWWWi.iWWWWWWi.iWWWW.iWW\nW............WW............W\nW.iWWWWWWWWi.WW.iWWWWWWWWi.W\nW.iWWWWWWWWi.WW.iWWWWWWWWi.W\nW............WW............W\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\n","\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\nWWWWWWWWWWWWWWWWWWWWWWWWWWWW\ni......ii....ii....ii......i\ni.iiii.ii.ii.ii.ii.ii.iiii.i\ni.iiii.ii.ii.ii.ii.ii.iiii.i\ni.iiii.ii.ii.ii.ii.ii.iiii.i\ni......ii..........ii......i\ni.iiiiiii.iiiiiiii.iiiiiii.i\ni.iiiiiii.iiiiiiii.iiiiiii.i\ni......ii....ii....ii......i\niiiiii.iiiii.ii.iiiii.iiiiii\niiiiii.iiiii.ii.iiiii.iiiiii\ni......ii....ii....ii......i\ni.iiii.ii.iiiiiiii.ii.iiii.i\ni.iiii.ii.ieeeeeei.ii.iiii.i\ni......ii.eeeSeeee.ii......i\ni.iiiiiii.ieeeeeei.iiiiiii.i\ni.iiiiiii.iiiiiiii.iiiiiii.i\ni......ii....ii....ii......i\ni.iiii.ii.iiiiiiii.ii.iiiiii\ni.iiii.ii.iiiiiiii.ii.iiiiii\ni............ii............i\ni.iiii.iiiii.ii.iiiii.iiii.i\ni.iiii.iiiii.ii.iiiii.iiii.i\ni...ii.......ii.......ii...i\niii.iiiii.iiiiiiii.iiiii.iii\niii.iiiii.iiiiiiii.iiiii.iii\ni............ii............i\ni.iiiiiiiiii.ii.iiiiiiiiii.i\ni.iiiiiiiiii.ii.iiiiiiiiii.i\ni............ii............i\niiiiiiiiiiiiiiiiiiiiiiiiiiii\n"],o=[{heroSpeed:50,heroNumber:4,myDungeonMap:n[0],viewField:250},{heroSpeed:70,heroNumber:6,myDungeonMap:n[1],viewField:200},{heroSpeed:80,heroNumber:8,myDungeonMap:n[2],viewField:150}];const r=new class{constructor(){return this.currentLevel=1,this.heroSpeed=o[this.currentLevel].heroSpeed,this.heroNumber=o[this.currentLevel].heroNumber,this.myDungeonMap=o[this.currentLevel].myDungeonMap,this.viewField=o[this.currentLevel].viewField,this.skeletonPosition={},this.allChestsOpen=!1,this.isSkeletonDead=!1,this.debug=!1,this}update(i){}keyboardEvent(i){}draw(i,e){}},h={rock:{sheet:"dungeon",pos:{x:0,y:207},size:{x:18,y:16},dest:{x:40,y:30},offset:{x:0,y:0}},water:{sheet:"dungeon",pos:{x:16,y:207},size:{x:18,y:16},dest:{x:40,y:30},offset:{x:0,y:0}},fire:{sheet:"dungeon",pos:{x:32,y:207},size:{x:18,y:16},dest:{x:40,y:30},offset:{x:0,y:0}},closedChest:{sheet:"dungeon",pos:{x:240,y:174},size:{x:30,y:18},dest:{x:45,y:30},offset:{x:0,y:8}},openChest:{sheet:"dungeon",pos:{x:240,y:208},size:{x:30,y:18},dest:{x:45,y:30},offset:{x:0,y:8}},wall:{sheet:"dungeon",pos:{x:0,y:16},size:{x:20,y:18},dest:{x:30,y:30},offset:{x:0,y:0}},floor:{sheet:"dungeon",pos:{x:64,y:96},size:{x:20,y:18},dest:{x:30,y:30},offset:{x:0,y:0}},torch:{sheet:"dungeon",frames:8,pos:{x:132,y:153},size:{x:16,y:13},dest:{x:26,y:23},offset:{x:-5,y:8}}};s.register("bdfdX",(function(i,e){i.exports=s("kPq84").getBundleURL("aYtYf")+s("bXuNP").resolve("6DGUb")})),s.register("kPq84",(function(e,W){var t;i(e.exports,"getBundleURL",(()=>t),(i=>t=i));var s={};function n(i){return(""+i).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}t=function(i){var e=s[i];return e||(e=function(){try{throw new Error}catch(e){var i=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(i)return n(i[2])}return"/"}(),s[i]=e),e}}));const a={dungeon:(i=>{const e=new Image;return e.src=i,e})(s("bdfdX"))};const l=new class{constructor(){this.render_torch_time=0}getObject(i){const e=h[i];if(e)return e;throw new Error(`No object to draw with name ${i}`)}getDrawElements(i,e,W,t=0,s=0){this.render_torch_time+=t;const n=Math.floor(this.render_torch_time+s/8),{pos:o,size:r,dest:h,frames:l,offset:d}=this.getObject(e),c=l?n%l:0;i.drawImage(a.dungeon,o.x+r.x*c,o.y,r.x,r.y,W.x-d.x,W.y-d.y,h.x,h.y)}drawHalf(i,e,W,t=!1){const{pos:s,size:n,dest:o,offset:r}=this.getObject(e);i.drawImage(a.dungeon,t?s.x+n.x/2:s.x,s.y-n.y,n.x/2,n.y,t?W.x+48-r.x:W.x+20-r.x,W.y-8,o.x-12,o.y)}getDrawHeaders(i,e,W){const t=450,s=10,n={rock:{x:0,y:0},fire:{x:50,y:0},water:{x:100,y:0}};this.drawHalf(i,e,{x:t+n[e].x,y:s+n[e].y},W)}};const d=new class{constructor(i=23){this.position={x:0,y:0},this.tileSize=i,this.currentLevel=r.currentLevel;const e=r.myDungeonMap.trim().split("\n");return this.map=e.map((i=>i.split(""))),this}GetDungeonStart(){for(let i=0;i<this.map.length;i+=1)for(let e=0;e<this.map[i].length;e+=1)if("S"===this.map[i][e])return this.editedTilePos(i,e);throw new Error("Set the S for skeleton start")}getRandomLocations(i){const e=[];for(let W=0;W<this.map.length;W+=1)for(let t=0;t<this.map[W].length;t+=1)"."===this.map[W][t]&&("chest"===i?e.push(this.tilePos(W,t)):e.push(this.editedTilePos(W,t)));return e}posToTile(i){const e=Math.floor((i.x-this.position.x)/this.tileSize);return[Math.floor((i.y-this.position.y)/this.tileSize),e]}tileAtIndex(i){try{return this.map[i[0]][i[1]]}catch(i){return!1}}tile(i,e){const W=this.posToTile(i),t=[W[0]+e[1],W[1]+e[0]];return this.tileAtIndex(t)}tilePos(i,e){return{x:this.position.x+e*this.tileSize,y:this.position.y+i*this.tileSize}}editedTilePos(i,e){return{x:this.position.x+this.tileSize*e+this.tileSize/2,y:this.position.y+this.tileSize*i+this.tileSize/2}}drawWall(i,e,W){l.getDrawElements(i,"wall",this.tilePos(e,W))}drawFloor(i,e,W){l.getDrawElements(i,"floor",this.tilePos(e,W))}drawTorch(i,e,W,t){this.drawWall(e,W,t);const s=Math.floor(8*Math.random());l.getDrawElements(e,"torch",this.tilePos(W,t),i,s)}keyboardEvent(){}update(){}draw(i,e){for(let W=0;W<this.map.length;W+=1)for(let t=0;t<this.map[W].length;t+=1){const s=this.map[W][t];"W"===s&&this.drawWall(e,W,t),"i"===s&&this.drawTorch(i,e,W,t),"."!==s&&"S"!==s&&"e"!==s||this.drawFloor(e,W,t)}}};class c{constructor(i,e,W,t){this.position={x:i.x,y:i.y},this.headerPosition={x:10,y:10},this.value=e,this.num=W,this.isChestOpen=t}draw(i,e){if(this.isChestOpen||r.debug)switch(l.getDrawElements(e,"openChest",this.position,i),this.value){case"AA":l.getDrawElements(e,"rock",this.position,i),l.getDrawHeaders(e,"rock",this.num);break;case"BB":l.getDrawElements(e,"water",this.position,i),l.getDrawHeaders(e,"water",this.num);break;case"CC":l.getDrawElements(e,"fire",this.position,i),l.getDrawHeaders(e,"fire",this.num)}else l.getDrawElements(e,"closedChest",this.position)}}const p=new class{constructor(){return this.chests=[new c(this.chestStartOptions(),"AA",0,!1),new c(this.chestStartOptions(),"AA",1,!1),new c(this.chestStartOptions(),"BB",0,!1),new c(this.chestStartOptions(),"BB",1,!1),new c(this.chestStartOptions(),"CC",0,!1),new c(this.chestStartOptions(),"CC",1,!1)],this.latestOpenedChest="",this.chestInfo=[],this}update(i){}keyboardEvent(i){}draw(i,e){}chestStartOptions(){let i=[];i=d.getRandomLocations("chest");let e=0;return e=Math.floor(Math.random()*i.length),i[e]}checkChestsStatus(){r.allChestsOpen=this.chests.every((i=>!0===i.isChestOpen))}};var u;u=s("kPq84").getBundleURL("aYtYf")+s("bXuNP").resolve("lBejV");const m={0:{currentSequence:"right",speedX:r.heroSpeed,speedY:0},1:{currentSequence:"left",speedX:-r.heroSpeed,speedY:0},2:{currentSequence:"up",speedX:0,speedY:-r.heroSpeed},3:{currentSequence:"down",speedX:0,speedY:r.heroSpeed}};class y{constructor(i,e){this.position={x:i.x,y:i.y},this.heroSize=10,this.spritesheet=new Image,this.spritesheet.src=u,this.sequences=[{name:"still-down",numFrames:1,ySeqPos:0},{name:"still-left",numFrames:1,ySeqPos:1},{name:"still-up",numFrames:1,ySeqPos:2},{name:"still-right",numFrames:1,ySeqPos:3},{name:"moving-down",numFrames:10,ySeqPos:4},{name:"moving-left",numFrames:10,ySeqPos:5},{name:"moving-up",numFrames:10,ySeqPos:6},{name:"moving-right",numFrames:10,ySeqPos:7}],this.framePos=0,this.time=0,this.currentSequence="down",this.speed={x:0,y:0},this.hypoDirections=[[1,0],[-1,0],[0,-1],[0,1]],this.abailablesDirections=[],this.current_direction=[],this.stop=!0,this.map=e}draw(i,e){const W=120,t=130,s=0===this.speed.x&&0===this.speed.y?`still-${this.currentSequence}`:`moving-${this.currentSequence}`,n=this.sequences.find((i=>i.name===s));if(!n)throw new Error("invalid seq");e.drawImage(this.spritesheet,W*this.framePos,t*n.ySeqPos,W,t,this.position.x-12,this.position.y-23,W-95,t-95),this.time+=i,1===n.numFrames?this.framePos=Math.floor(3*this.time)%n.numFrames:this.framePos=Math.floor(10*this.time)%n.numFrames,this.killSkeleton()}update(i){r.allChestsOpen?(this.currentSequence="down",this.speed={x:0,y:0}):(this.current_direction.length<1&&this.setDirection(),this.getMove(i))}getAbailablesDirections(){let i={};const e=this.hypoDirections;return e.filter(((W,t)=>{i={x:this.position.x-e[t][0]*this.heroSize,y:this.position.y-e[t][1]*this.heroSize};const s=this.map.tile(i,e[t]);if("W"!==s&&"i"!==s)return e[t]}))}setDirection(){this.abailablesDirections=this.getAbailablesDirections();let i=0;i=Math.floor(Math.random()*this.abailablesDirections.length),this.current_direction=this.abailablesDirections[i]}getMove(i){const e=m[this.hypoDirections.findIndex((i=>i===this.current_direction))],{currentSequence:W,speedX:t,speedY:s}=e;this.currentSequence=W,this.speed.x=t,this.speed.y=s,this.nextTile(i)}nextTile(i){const e=this.position.x+this.speed.x*i,W=this.position.y+this.speed.y*i,t=this.current_direction,s={x:this.position.x-t[0]*this.heroSize,y:this.position.y-t[1]*this.heroSize},n=this.map.tile(s,t);"W"!==n&&"i"!==n?(this.position.x=e,this.position.y=W):this.current_direction=[]}killSkeleton(){let i=0;i=Math.sqrt(Math.pow(this.position.x-r.skeletonPosition.x,2)+Math.pow(this.position.y-r.skeletonPosition.y,2)),i<15&&(r.isSkeletonDead=!0)}}const f=new class{constructor(){return this.heroes=[],this}update(i){}keyboardEvent(i){}draw(i,e){}setHeroes(){for(let i=0;i<r.heroNumber;i+=1)this.heroes.push(new y(this.heroStartOptions(),d))}heroStartOptions(){let i=[];i=d.getRandomLocations("hero");let e=0;return e=Math.floor(Math.random()*i.length),i[e]}};var w;w=s("kPq84").getBundleURL("aYtYf")+s("bXuNP").resolve("7FNnd");class x{constructor(i,e){this.position={x:i.x,y:i.y},this.skeletonSize=10,this.spritesheet=new Image,this.spritesheet.src=w,this.sequences=[{name:"still-down",numFrames:2,ySeqPos:2},{name:"still-left",numFrames:2,ySeqPos:1},{name:"still-up",numFrames:2,ySeqPos:0},{name:"still-right",numFrames:2,ySeqPos:3},{name:"still-dead",numFrames:1,ySeqPos:20},{name:"still-dance",numFrames:5,ySeqPos:14},{name:"moving-down",numFrames:7,ySeqPos:10},{name:"moving-left",numFrames:7,ySeqPos:9},{name:"moving-up",numFrames:7,ySeqPos:8},{name:"moving-right",numFrames:7,ySeqPos:11}],this.framePos=0,this.time=0,this.currentSequence="down",this.speed={x:0,y:0},this.map=e}draw(i,e){const W=64,t=64,s=0===this.speed.x&&0===this.speed.y?`still-${this.currentSequence}`:`moving-${this.currentSequence}`,n=this.sequences.find((i=>i.name===s));if(!n)throw new Error("invalid seq");this.drawShadow(e),e.drawImage(this.spritesheet,W*this.framePos,t*n.ySeqPos,W,t,this.position.x-20,this.position.y-25,W-25,t-25),this.time+=i,this.framePos=Math.floor(this.time*n.numFrames)%n.numFrames,r.skeletonPosition=this.position,p.checkChestsStatus()}update(i){if(r.isSkeletonDead&&!r.debug)this.currentSequence="dead",this.speed={x:0,y:0},this.framePos=5;else if(r.allChestsOpen&&"dance"!==this.currentSequence)this.currentSequence="dance",this.speed={x:0,y:0},this.framePos=2;else{const e=this.position.x+this.speed.x*i,W=this.position.y+this.speed.y*i,t=this.getDirection(),s={x:this.position.x-t[0]*this.skeletonSize,y:this.position.y-t[1]*this.skeletonSize},n=this.map.tile(s,t);"W"!==n&&"i"!==n&&(this.position.x=e,this.position.y=W)}}getDirection(){let i=[1,0];return 0!==this.speed.x&&this.speed.x<0&&(i=[-1,0]),0!==this.speed.y&&this.speed.y>0&&(i=[0,1]),0!==this.speed.y&&this.speed.y<0&&(i=[0,-1]),i}keyboardEvent(i){switch(i){case"ArrowLeft":this.currentSequence="left",this.speed.x=-100;break;case"ArrowRight":this.currentSequence="right",this.speed.x=100;break;case"ArrowUp":this.currentSequence="up",this.speed.y=-100;break;case"ArrowDown":this.currentSequence="down",this.speed.y=100;break;case"a":case"A":this.open()}}keyboardEventUp(){this.speed.x=0,this.speed.y=0}open(){let i=0;p.chests.forEach((e=>{if(i=0,i=Math.sqrt(Math.pow(this.position.x-e.position.x,2)+Math.pow(this.position.y-e.position.y,2)),i<30&&!e.isChestOpen)switch(p.latestOpenedChest){case"":e.isChestOpen=!0,p.latestOpenedChest=e.value;break;case e.value:e.isChestOpen=!0,p.latestOpenedChest="";break;default:p.chests.forEach((i=>i.isChestOpen=!1)),p.latestOpenedChest="",e.isChestOpen=!0,p.latestOpenedChest=e.value}}))}drawShadow(i){"dance"===this.currentSequence&&r.viewField++;const e=document.getElementById("canvas"),W=document.getElementById("canvasShadow");W.width=e.width,W.height=e.height;const t=W.getContext("2d");t.fillStyle="black",t.fillRect(0,38,W.width,W.height),t.globalCompositeOperation="destination-out",t.arc(this.position.x,this.position.y,r.viewField,0,2*Math.PI),t.fill(),i.drawImage(W,0,0)}}class g{constructor(i){this.position=i}keyboardEvent(){}update(){}draw(i,e){const W=(1/i).toFixed(2);e.font="15px Arial",e.fillStyle="white",e.fillText(`FPS: ${W}`,this.position.x,this.position.y)}}class S{constructor(i){this.position=i,this.seg=0,this.min=0}keyboardEvent(){}update(){}draw(i,e){r.isSkeletonDead||r.allChestsOpen||(this.seg+=i);let W=Math.floor(this.seg);this.seg<10&&(W=parseInt(`0${W}`)),60===W&&(this.min+=1,this.seg=0);const t=`Time: ${this.min}:${W}`;e.font="15px Arial",e.fillStyle="white",e.fillText(`${t} `,this.position.x,this.position.y)}}class b{constructor(i){this.position=i}keyboardEvent(){}update(){}draw(i,e){e.font="15px Arial",e.fillStyle="white",e.fillText("Press 'a' to open the chests",this.position.x+100,this.position.y),e.fillText(`Level ${r.currentLevel}`,this.position.x+300,this.position.y)}}window.onload=()=>{const i=document.getElementById("canvas").getContext("2d"),e=d;f.setHeroes();const W=e.GetDungeonStart(),t=[e,new g({x:5,y:15}),new S({x:100,y:15}),new b({x:100,y:15}),new x(W,e),...p.chests,...f.heroes];let s=0;const n=e=>{const W=(e-s)/1e3;s=e,t.forEach((i=>i.update&&i.update(W))),i.clearRect(0,0,650,720),t.sort(((i,e)=>i.position.y-e.position.y)).forEach((e=>e.draw(W,i))),window.requestAnimationFrame(n)};window.requestAnimationFrame(n),document.body.addEventListener("keydown",(i=>{t.forEach((e=>e.keyboardEvent&&e.keyboardEvent(i.key)))})),document.body.addEventListener("keyup",(i=>{t.forEach((e=>e.keyboardEventUp&&e.keyboardEventUp(i.key)))}))};
//# sourceMappingURL=index.8edb6abb.js.map
